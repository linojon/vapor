tinymce.PluginManager.add("lists",function(e){var n=this;e.on("init",function(){function t(e){function n(n){var r,i,a;i=e[n?"startContainer":"endContainer"],a=e[n?"startOffset":"endOffset"],1==i.nodeType&&(r=g.create("span",{"data-mce-type":"bookmark"}),i.hasChildNodes()?(a=Math.min(a,i.childNodes.length-1),i.insertBefore(r,i.childNodes[a])):i.appendChild(r),i=r,a=0),t[n?"startContainer":"endContainer"]=i,t[n?"startOffset":"endOffset"]=a}var t={};return n(!0),n(),t}function r(e){function n(n){function t(e){for(var n=e.parentNode.firstChild,t=0;n;){if(n==e)return t;(1!=n.nodeType||"bookmark"!=n.getAttribute("data-mce-type"))&&t++,n=n.nextSibling}return-1}var r,i,a;r=a=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"],1==r.nodeType&&(n?(i=t(r),r=r.parentNode):(i=t(r),r=r.parentNode),g.remove(a)),e[n?"startContainer":"endContainer"]=r,e[n?"startOffset":"endOffset"]=i}n(!0),n();var t=g.createRng();t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),y.setRng(t)}function i(e){return e&&/^(OL|UL)$/.test(e.nodeName)}function a(e){return e.parentNode.firstChild==e}function o(e){return e.parentNode.lastChild==e}function d(n){return n&&!!e.schema.getTextBlockElements()[n.nodeName]}function f(n,t){var r,i;if(e.settings.forced_root_block&&(t=t||e.settings.forced_root_block),i=t?g.create(t):g.createFragment(),n)for(;r=n.firstChild;)i.appendChild(r);return e.settings.forced_root_block||i.appendChild(g.create("br")),i.hasChildNodes()||tinymce.isIE||(i.innerHTML='<br data-mce-bogus="1">'),i}function s(){return tinymce.grep(y.getSelectedBlocks(),function(e){return"LI"==e.nodeName})}function c(){return tinymce.grep(y.getSelectedBlocks(),d)}function l(e,n,t){var r,i;t=t||f(n),r=g.createRng(),r.setStartAfter(n),r.setEndAfter(e),i=r.extractContents(),g.isEmpty(i)||g.insertAfter(i,e),g.isEmpty(t)||g.insertAfter(t,e),g.isEmpty(n.parentNode)&&g.remove(n.parentNode),g.remove(n)}function u(e){var n,t;if(n=e.nextSibling,n&&i(n)&&n.nodeName==e.nodeName){for(;t=n.firstChild;)e.appendChild(t);g.remove(n)}if(n=e.previousSibling,n&&i(n)&&n.nodeName==e.nodeName){for(;t=n.firstChild;)e.insertBefore(t,e.firstChild);g.remove(n)}}function p(e){tinymce.each(tinymce.grep(g.select("ol,ul",e)),function(e){var n,t=e.parentNode;"LI"==t.nodeName&&t.firstChild==e&&(n=t.previousSibling,n&&"LI"==n.nodeName&&(n.appendChild(e),g.isEmpty(t)&&g.remove(t))),i(t)&&(n=t.previousSibling,n&&"LI"==n.nodeName&&n.appendChild(e))})}function m(){var e,n=t(y.getRng(!0));return tinymce.each(s(),function(n){var t,r;return t=n.previousSibling,t&&"UL"==t.nodeName?(t.appendChild(n),void 0):t&&"LI"==t.nodeName&&i(t.lastChild)?(t.lastChild.appendChild(n),void 0):(t=n.nextSibling,t&&"UL"==t.nodeName?(t.insertBefore(n,t.firstChild),void 0):(t&&"LI"==t.nodeName&&i(n.lastChild)||(t=n.previousSibling,t&&"LI"==t.nodeName&&(r=g.create(n.parentNode.nodeName),t.appendChild(r),r.appendChild(n)),e=!0),void 0))}),r(n),e}function v(){var e,n=t(y.getRng(!0));return tinymce.each(s(),function(n){var t,r=n.parentNode,d=r.parentNode;if(a(n)&&o(n))if("LI"==d.nodeName)g.insertAfter(n,d);else{if(!i(d))return;g.remove(r,!0)}else if(a(n))if("LI"==d.nodeName)g.insertAfter(n,d),t=g.create("LI"),t.appendChild(r),g.insertAfter(t,n);else{if(!i(d))return;d.insertBefore(n,r)}else if(o(n))if("LI"==d.nodeName)g.insertAfter(n,d);else{if(!i(d))return;g.insertAfter(n,r)}else{if("LI"==d.nodeName)r=d,t=f(n,"LI");else{if(!i(d))return;t=f(n,"LI")}l(r,n,t),p(r.parentNode)}e=!0}),r(n),e}function C(n){function a(){function n(n){var t,r,i=e.getBody();for(t=o[n?"startContainer":"endContainer"],r=o[n?"startOffset":"endOffset"],1==t.nodeType&&(t=t.childNodes[Math.min(r,t.childNodes.length-1)]||t);t.parentNode!=i;){if(d(t))return t;if(/^(TD|TH)$/.test(t.parentNode.nodeName))return t;t=t.parentNode}return t}function t(e,n){var t,r=[];if(!d(e)){for(;e&&(t=e[n?"previousSibling":"nextSibling"],!g.isBlock(t)&&t);)e=t;for(;e;)r.push(e),e=e[n?"nextSibling":"previousSibling"]}return r}var r,i,a=n(!0),f=n();i=t(a,!0),a!=f&&(i=i.concat(t(f).reverse())),tinymce.each(i,function(e){if(!g.isBlock(e)||"BR"==e.nodeName){if(!r||"BR"==e.nodeName){if("BR"==e.nodeName&&(!e.nextSibling||g.isBlock(e.nextSibling)&&"BR"!=e.nextSibling.nodeName))return g.remove(e),!1;r=g.create("p"),s.push(r),e.parentNode.insertBefore(r,e)}return"BR"!=e.nodeName?r.appendChild(e):g.remove(e),e==f?!1:void 0}})}var o=y.getRng(!0),f=t(o),s=c();a(),tinymce.each(s,function(e){var t,r;r=e.previousSibling,r&&i(r)&&r.nodeName==n?(t=r,e=g.rename(e,"LI"),r.appendChild(e)):(t=g.create(n),e.parentNode.insertBefore(t,e),t.appendChild(e),e=g.rename(e,"LI")),u(t)}),r(f)}function h(){var e=t(y.getRng(!0));tinymce.each(s(),function(e){var n,t;for(n=e;n;n=n.parentNode)i(n)&&(t=n);l(t,e)}),r(e)}function N(e){var n=g.getParent(y.getStart(),"OL,UL");if(n)if(n.nodeName==e)h(e);else{var i=t(y.getRng(!0));u(g.rename(n,e)),r(i)}else C(e)}var g=e.dom,y=e.selection;n.backspaceDelete=function(e){function n(e,n){var t=e.startContainer,r=e.startOffset;if(3==t.nodeType&&(n?r<t.data.length:r>0))return t;for(var i=new tinymce.dom.TreeWalker(e.startContainer);t=i[n?"next":"prev"]();)if(3==t.nodeType&&t.data.length>0)return t}function a(e,n){var t,r,a=e.parentNode;for(i(n.lastChild)&&(r=n.lastChild),t=n.lastChild,t&&"BR"==t.nodeName&&e.hasChildNodes()&&g.remove(t);t=e.firstChild;)n.appendChild(t);r&&n.appendChild(r),g.remove(e),g.isEmpty(a)&&g.remove(a)}if(y.isCollapsed()){var o=g.getParent(y.getStart(),"LI");if(o){var d=y.getRng(!0),f=g.getParent(n(d,e),"LI");if(f&&f!=o){var s=t(d);return e?a(f,o):a(o,f),r(s),!0}if(!f&&!e&&h(o.parentNode.nodeName))return!0}}},e.addCommand("Indent",function(){return m()?void 0:!0}),e.addCommand("Outdent",function(){return v()?void 0:!0}),e.addCommand("InsertUnorderedList",function(){N("UL")}),e.addCommand("InsertOrderedList",function(){N("OL")})}),e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?n.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&n.backspaceDelete(!0)&&e.preventDefault()})});